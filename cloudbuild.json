{
  "options": {
    "env": [
      "GIT_AUTHOR_NAME=BuildSystem",
      "GIT_AUTHOR_EMAIL=noreply@gurganus.name"
    ]
  },
  "steps": [
    {
      "name": "gcr.io/cloud-builders/git",
      "shell": "! git log -1 --pretty=%B|grep SKIPBUILD"
    },
    {
      "name": "node",
      "entrypoint": "npm",
      "args": ["install"]
    },
    {
      "name": "node",
      "entrypoint": "npx",
      "args": ["prettier", "--check", "."]
    },
    {
      "name": "node",
      "entrypoint": "npm",
      "args": ["run", "build"]
    },
    {
      "name": "gcr.io/$PROJECT_ID/firebase",
      "args": ["deploy"]
    },
    {
      "name": "node",
      "entrypoint": "npm",
      "args": [
        "version",
        "minor",
        "-m",
        "'SKIPBUILD for pushed version update %s'"
      ],
      "env": [
        "GIT_AUTHOR_NAME=BuildSystem",
        "GIT_AUTHOR_EMAIL=noreply@gurganus.name",
        "EMAIL=noreply@gurganus.name"
      ]
    },
    {
      "name": "gcr.io/cloud-builders/git",
      "args": ["push", "origin", "master"]
    },
    {
      "name": "gcr.io/cloud-builders/git",
      "args": ["push", "--tags", "origin", "master"]
    }
  ]
}
